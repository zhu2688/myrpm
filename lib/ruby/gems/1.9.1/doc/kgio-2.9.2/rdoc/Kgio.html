<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Module: Kgio</title>

  <link rel="stylesheet" href="./rdoc.css" type="text/css" media="screen" />

  <script src="./js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="./js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="module">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="./lib/kgio_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/kgio.rb">lib/kgio.rb</a></li>
          
            <li><a href="./ext/kgio/accept_c.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="ext/kgio/accept.c">ext/kgio/accept.c</a></li>
          
            <li><a href="./ext/kgio/autopush_c.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="ext/kgio/autopush.c">ext/kgio/autopush.c</a></li>
          
            <li><a href="./ext/kgio/connect_c.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="ext/kgio/connect.c">ext/kgio/connect.c</a></li>
          
            <li><a href="./ext/kgio/kgio_ext_c.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="ext/kgio/kgio_ext.c">ext/kgio/kgio_ext.c</a></li>
          
            <li><a href="./ext/kgio/poll_c.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="ext/kgio/poll.c">ext/kgio/poll.c</a></li>
          
            <li><a href="./ext/kgio/wait_c.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="ext/kgio/wait.c">ext/kgio/wait.c</a></li>
          
            <li><a href="./ext/kgio/tryopen_c.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="ext/kgio/tryopen.c">ext/kgio/tryopen.c</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      

      

      
      <!-- Namespace Contents -->
      <div id="namespace-list-section" class="section">
        <h3 class="section-header">Namespace</h3>
        <ul class="link-list">
          
          <li><span class="type">MODULE</span> <a href="Kgio/DefaultWaiters.html">Kgio::DefaultWaiters</a></li>
          
          <li><span class="type">MODULE</span> <a href="Kgio/PipeMethods.html">Kgio::PipeMethods</a></li>
          
          <li><span class="type">MODULE</span> <a href="Kgio/SocketMethods.html">Kgio::SocketMethods</a></li>
          
          <li><span class="type">CLASS</span> <a href="Kgio/File.html">Kgio::File</a></li>
          
          <li><span class="type">CLASS</span> <a href="Kgio/Pipe.html">Kgio::Pipe</a></li>
          
          <li><span class="type">CLASS</span> <a href="Kgio/Socket.html">Kgio::Socket</a></li>
          
          <li><span class="type">CLASS</span> <a href="Kgio/TCPServer.html">Kgio::TCPServer</a></li>
          
          <li><span class="type">CLASS</span> <a href="Kgio/TCPSocket.html">Kgio::TCPSocket</a></li>
          
          <li><span class="type">CLASS</span> <a href="Kgio/UNIXServer.html">Kgio::UNIXServer</a></li>
          
          <li><span class="type">CLASS</span> <a href="Kgio/UNIXSocket.html">Kgio::UNIXSocket</a></li>
          
        </ul>
      </div>
      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-accept_class">::accept_class</a></li>
          
          <li><a href="#method-c-accept_class-3D">::accept_class=</a></li>
          
          <li><a href="#method-c-accept_cloexec-3D">::accept_cloexec=</a></li>
          
          <li><a href="#method-c-accept_cloexec-3F">::accept_cloexec?</a></li>
          
          <li><a href="#method-c-accept_nonblock-3D">::accept_nonblock=</a></li>
          
          <li><a href="#method-c-accept_nonblock-3F">::accept_nonblock?</a></li>
          
          <li><a href="#method-c-autopush-3D">::autopush=</a></li>
          
          <li><a href="#method-c-autopush-3F">::autopush?</a></li>
          
          <li><a href="#method-c-poll">::poll</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="./ChangeLog.html">ChangeLog</a></li>
        
          <li class="file"><a href="./HACKING.html">HACKING</a></li>
        
          <li class="file"><a href="./ISSUES.html">ISSUES</a></li>
        
          <li class="file"><a href="./LATEST.html">LATEST</a></li>
        
          <li class="file"><a href="./LICENSE.html">LICENSE</a></li>
        
          <li class="file"><a href="./NEWS.html">NEWS</a></li>
        
          <li class="file"><a href="./README.html">README</a></li>
        
          <li class="file"><a href="./TODO.html">TODO</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="./images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="./Kgio.html">Kgio</a></li>
        
          <li><a href="./Kgio/DefaultWaiters.html">Kgio::DefaultWaiters</a></li>
        
          <li><a href="./Kgio/File.html">Kgio::File</a></li>
        
          <li><a href="./Kgio/Pipe.html">Kgio::Pipe</a></li>
        
          <li><a href="./Kgio/PipeMethods.html">Kgio::PipeMethods</a></li>
        
          <li><a href="./Kgio/Socket.html">Kgio::Socket</a></li>
        
          <li><a href="./Kgio/SocketMethods.html">Kgio::SocketMethods</a></li>
        
          <li><a href="./Kgio/TCPServer.html">Kgio::TCPServer</a></li>
        
          <li><a href="./Kgio/TCPSocket.html">Kgio::TCPSocket</a></li>
        
          <li><a href="./Kgio/UNIXServer.html">Kgio::UNIXServer</a></li>
        
          <li><a href="./Kgio/UNIXSocket.html">Kgio::UNIXSocket</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="module">Kgio</h1>

    <div id="description" class="description">
      
<p>See the <a href="index.html">README</a></p>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      
      <!-- Constants -->
      <div id="constants-list" class="section">
        <h3 class="section-header">Constants</h3>
        <dl>
        
          <dt><a name="LOCALHOST">LOCALHOST</a></dt>
          
          <dd class="description"><p>The IPv4 address of UNIX domain sockets, useful for creating Rack (and CGI)
servers that also serve HTTP traffic over UNIX domain sockets.</p></dd>
          
        
          <dt><a name="MSG_FASTOPEN">MSG_FASTOPEN</a></dt>
          
          <dd class="description"></dd>
          
        
          <dt><a name="SOCK_CLOEXEC">SOCK_CLOEXEC</a></dt>
          
          <dd class="description"><p>Maps to the <a href="Kgio.html#SOCK_CLOEXEC">SOCK_CLOEXEC</a> constant in
Linux for setting the close-on-exec flag on newly accepted descriptors. 
This is enabled by default, and there is usually no reason to disable
close-on-exec for accepted sockets.</p></dd>
          
        
          <dt><a name="SOCK_NONBLOCK">SOCK_NONBLOCK</a></dt>
          
          <dd class="description"><p>Maps to the <a href="Kgio.html#SOCK_NONBLOCK">SOCK_NONBLOCK</a> constant in
Linux for setting the non-blocking flag on newly accepted sockets.  This is
usually unnecessary as sockets are made non-blocking whenever non-blocking
methods are used.</p></dd>
          
        
          <dt><a name="TCP_FASTOPEN">TCP_FASTOPEN</a></dt>
          
          <dd class="description"></dd>
          
        
          <dt><a name="WaitReadable">WaitReadable</a></dt>
          
          <dd class="description"><p>Kgio::PipeMethods#kgio_tryread and Kgio::SocketMethods#kgio_tryread will
return :wait_readable when waiting for a read is required.</p></dd>
          
        
          <dt><a name="WaitWritable">WaitWritable</a></dt>
          
          <dd class="description"><p>PipeMethods#kgio_trywrite and SocketMethods#kgio_trywrite will return
:wait_writable when waiting for a read is required.</p></dd>
          
        
        </dl>
      </div>
      

      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="accept_class-method" class="method-detail ">
          <a name="method-c-accept_class"></a>

          
          <div class="method-heading">
            <span class="method-name">accept_class</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Returns the default class for newly accepted sockets when kgio_accept or
kgio_tryaccept are not passed arguments</p>
            

            
            <div class="method-source-code" id="accept_class-source">
<pre>
static VALUE get_accepted(VALUE klass)
{
        return cClientSocket;
}</pre>
            </div><!-- accept_class-source -->
            
          </div>

          

          
        </div><!-- accept_class-method -->

      
        <div id="accept_class-3D-method" class="method-detail ">
          <a name="method-c-accept_class-3D"></a>

          
          <div class="method-heading">
            <span class="method-name">accept_class=</span><span
              class="method-args">(p1)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Sets the default class for newly accepted sockets.  This is legacy
behavior, kgio_accept and kgio_tryaccept now take optional class arguments
to override this value.</p>
            

            
            <div class="method-source-code" id="accept_class-3D-source">
<pre>
static VALUE set_accepted(VALUE klass, VALUE aclass)
{
        VALUE tmp;

        if (NIL_P(aclass))
                aclass = cKgio_Socket;

        tmp = rb_funcall(aclass, rb_intern(&quot;included_modules&quot;), 0, 0);
        tmp = rb_funcall(tmp, rb_intern(&quot;include?&quot;), 1, mSocketMethods);

        if (tmp != Qtrue)
                rb_raise(rb_eTypeError,
                         &quot;class must include Kgio::SocketMethods&quot;);

        cClientSocket = aclass;

        return aclass;
}</pre>
            </div><!-- accept_class-3D-source -->
            
          </div>

          

          
        </div><!-- accept_class-3D-method -->

      
        <div id="accept_cloexec-3D-method" class="method-detail ">
          <a name="method-c-accept_cloexec-3D"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">accept_cloexec = true</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          <div class="method-heading">
            <span class="method-callseq">accept_cloexec = false</span>
            
          </div>
          
          

          <div class="method-description">
            
            <p>Sets whether or not <a href="Kgio/Socket.html">Kgio::Socket</a> objects
created by <a
href="Kgio/TCPServer.html#method-i-kgio_accept">TCPServer#kgio_accept</a>,
<a
href="Kgio/TCPServer.html#method-i-kgio_tryaccept">TCPServer#kgio_tryaccept</a>,
<a
href="Kgio/UNIXServer.html#method-i-kgio_accept">UNIXServer#kgio_accept</a>,
and <a
href="Kgio/UNIXServer.html#method-i-kgio_tryaccept">UNIXServer#kgio_tryaccept</a>
default to being created with the FD_CLOEXEC file descriptor flag.</p>

<p>This is on by default, as there is little reason to deal to enable it for
client sockets on a socket server.</p>

<p>Deprecated, use the per-socket flags for kgio_*accept instead.</p>
            

            
            <div class="method-source-code" id="accept_cloexec-3D-source">
<pre>
static VALUE set_cloexec(VALUE mod, VALUE boolean)
{
        switch (TYPE(boolean)) {
        case T_TRUE:
                accept4_flags |= SOCK_CLOEXEC;
                return boolean;
        case T_FALSE:
                accept4_flags &amp;= ~SOCK_CLOEXEC;
                return boolean;
        }
        rb_raise(rb_eTypeError, &quot;not true or false&quot;);
        return Qnil;
}</pre>
            </div><!-- accept_cloexec-3D-source -->
            
          </div>

          

          
        </div><!-- accept_cloexec-3D-method -->

      
        <div id="accept_cloexec-3F-method" class="method-detail ">
          <a name="method-c-accept_cloexec-3F"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">accept_cloexec? &rarr; true or false</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          

          <div class="method-description">
            
            <p>Returns true if newly accepted Kgio::Sockets are created with the
FD_CLOEXEC file descriptor flag, false if not.</p>

<p>Deprecated, use the per-socket flags for kgio_*accept instead.</p>
            

            
            <div class="method-source-code" id="accept_cloexec-3F-source">
<pre>
static VALUE get_cloexec(VALUE mod)
{
        return (accept4_flags &amp; SOCK_CLOEXEC) == SOCK_CLOEXEC ? Qtrue : Qfalse;
}</pre>
            </div><!-- accept_cloexec-3F-source -->
            
          </div>

          

          
        </div><!-- accept_cloexec-3F-method -->

      
        <div id="accept_nonblock-3D-method" class="method-detail ">
          <a name="method-c-accept_nonblock-3D"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">accept_nonblock = true</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          <div class="method-heading">
            <span class="method-callseq">accept_nonblock = false</span>
            
          </div>
          
          

          <div class="method-description">
            
            <p>Sets whether or not <a href="Kgio/Socket.html">Kgio::Socket</a> objects
created by <a
href="Kgio/TCPServer.html#method-i-kgio_accept">TCPServer#kgio_accept</a>,
<a
href="Kgio/TCPServer.html#method-i-kgio_tryaccept">TCPServer#kgio_tryaccept</a>,
<a
href="Kgio/UNIXServer.html#method-i-kgio_accept">UNIXServer#kgio_accept</a>,
and <a
href="Kgio/UNIXServer.html#method-i-kgio_tryaccept">UNIXServer#kgio_tryaccept</a>
are created with the O_NONBLOCK file status flag.</p>

<p>This defaults to <tt>false</tt> for GNU/Linux where MSG_DONTWAIT is
available (and on newer GNU/Linux, accept4() may also set the non-blocking
flag.  This defaults to <tt>true</tt> on non-GNU/Linux systems.</p>

<p>This is always true on Ruby implementations using user-space threads.</p>

<p>Deprecated, use the per-socket flags for kgio_*accept instead.</p>
            

            
            <div class="method-source-code" id="accept_nonblock-3D-source">
<pre>
static VALUE set_nonblock(VALUE mod, VALUE boolean)
{
        switch (TYPE(boolean)) {
        case T_TRUE:
                accept4_flags |= SOCK_NONBLOCK;
                return boolean;
        case T_FALSE:
                accept4_flags &amp;= ~SOCK_NONBLOCK;
                return boolean;
        }
        rb_raise(rb_eTypeError, &quot;not true or false&quot;);
        return Qnil;
}</pre>
            </div><!-- accept_nonblock-3D-source -->
            
          </div>

          

          
        </div><!-- accept_nonblock-3D-method -->

      
        <div id="accept_nonblock-3F-method" class="method-detail ">
          <a name="method-c-accept_nonblock-3F"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">accept_nonblock? &rarr; true or false</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          

          <div class="method-description">
            
            <p>Returns true if newly accepted Kgio::Sockets are created with the
O_NONBLOCK file status flag, false if not.</p>

<p>Deprecated, use the per-socket flags for kgio_*accept instead.</p>
            

            
            <div class="method-source-code" id="accept_nonblock-3F-source">
<pre>
static VALUE get_nonblock(VALUE mod)
{
        return (accept4_flags &amp; SOCK_NONBLOCK)==SOCK_NONBLOCK ? Qtrue : Qfalse;
}</pre>
            </div><!-- accept_nonblock-3F-source -->
            
          </div>

          

          
        </div><!-- accept_nonblock-3F-method -->

      
        <div id="autopush-3D-method" class="method-detail ">
          <a name="method-c-autopush-3D"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">autopush = true</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          <div class="method-heading">
            <span class="method-callseq">autopush = false</span>
            
          </div>
          
          

          <div class="method-description">
            
            <p>Enables or disables autopush for sockets created with kgio_accept and
kgio_tryaccept methods.  Autopush relies on TCP_CORK/TCP_NOPUSH being
enabled on the listen socket.</p>

<p>Only available on systems with TCP_CORK (Linux) or TCP_NOPUSH (FreeBSD, and
maybe other *BSDs).</p>
            

            
            <div class="method-source-code" id="autopush-3D-source">
<pre>
static VALUE s_set_autopush(VALUE self, VALUE val)
{
        enabled = RTEST(val);

        return val;
}</pre>
            </div><!-- autopush-3D-source -->
            
          </div>

          

          
        </div><!-- autopush-3D-method -->

      
        <div id="autopush-3F-method" class="method-detail ">
          <a name="method-c-autopush-3F"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">autopush? &rarr; true or false</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          

          <div class="method-description">
            
            <p>Returns whether or not autopush is enabled.</p>

<p>Only available on systems with TCP_CORK (Linux) or TCP_NOPUSH (FreeBSD, and
maybe other *BSDs).</p>
            

            
            <div class="method-source-code" id="autopush-3F-source">
<pre>
static VALUE s_get_autopush(VALUE self)
{
        return enabled ? Qtrue : Qfalse;
}</pre>
            </div><!-- autopush-3F-source -->
            
          </div>

          

          
        </div><!-- autopush-3F-method -->

      
        <div id="poll-method" class="method-detail ">
          <a name="method-c-poll"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">poll({ $stdin => :wait_readable }, 100)  &rarr; hash or nil</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          <div class="method-heading">
            <span class="method-callseq">poll({ $stdin => Kgio::POLLIN }, 100)  &rarr; hash or nil</span>
            
          </div>
          
          

          <div class="method-description">
            
            <p>Accepts an input hash with IO objects to wait for as the key and the events
to wait for as its value.  The events may either be <tt>:wait_readable</tt>
or <tt>:wait_writable</tt> symbols or a Fixnum mask of Kgio::POLL*
constants:</p>

<pre>Kgio::POLLIN      - there is data to read
Kgio::POLLPRI     - there is urgent data to read
Kgio::POLLOUT     - writing will not block
Kgio::POLLRDHUP   - peer has shutdown writes (Linux 2.6.17+ only)</pre>

<p>Timeout is specified in Integer milliseconds just like the underlying
poll(2), not in seconds like IO.select.  A nil timeout means to wait
forever.  It must be an Integer or nil.</p>

<p><a href="Kgio.html#method-c-poll">Kgio.poll</a> modifies and returns its
input hash on success with the IO-like object as the key and an Integer
mask of events as the hash value.  It can return any of the events
specified in the input above, along with the following events:</p>

<pre>Kgio::POLLERR     - error condition occurred on the descriptor
Kgio::POLLHUP     - hang up
Kgio::POLLNVAL    - invalid request (bad file descriptor)</pre>

<p>This method is only available under Ruby 1.9 or any other implementations
that uses native threads and rb_thread_blocking_region()</p>
            

            
            <div class="method-source-code" id="poll-source">
<pre>
static VALUE s_poll(int argc, VALUE *argv, VALUE self)
{
        VALUE timeout;
        struct poll_args a;

        rb_scan_args(argc, argv, &quot;11&quot;, &amp;a.ios, &amp;timeout);
        a.timeout = num2timeout(timeout);
        a.fds = NULL;
        a.fd_to_io = NULL;

        return rb_ensure(do_poll, (VALUE)&amp;a, poll_free, (VALUE)&amp;a);
}</pre>
            </div><!-- poll-source -->
            
          </div>

          

          
        </div><!-- poll-method -->

      
      </div><!-- public-class-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

