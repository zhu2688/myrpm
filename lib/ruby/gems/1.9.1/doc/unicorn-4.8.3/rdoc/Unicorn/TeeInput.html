<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: Unicorn::TeeInput</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../lib/unicorn/tee_input_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/unicorn/tee_input.rb">lib/unicorn/tee_input.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="StreamInput.html">Unicorn::StreamInput</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-client_body_buffer_size">::client_body_buffer_size</a></li>
          
          <li><a href="#method-c-client_body_buffer_size-3D">::client_body_buffer_size=</a></li>
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-i-gets">#gets</a></li>
          
          <li><a href="#method-i-read">#read</a></li>
          
          <li><a href="#method-i-rewind">#rewind</a></li>
          
          <li><a href="#method-i-size">#size</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../Application_Timeouts.html">Application_Timeouts</a></li>
        
          <li class="file"><a href="../CONTRIBUTORS.html">CONTRIBUTORS</a></li>
        
          <li class="file"><a href="../ChangeLog.html">ChangeLog</a></li>
        
          <li class="file"><a href="../DESIGN.html">DESIGN</a></li>
        
          <li class="file"><a href="../FAQ.html">FAQ</a></li>
        
          <li class="file"><a href="../HACKING.html">HACKING</a></li>
        
          <li class="file"><a href="../ISSUES.html">ISSUES</a></li>
        
          <li class="file"><a href="../KNOWN_ISSUES.html">KNOWN_ISSUES</a></li>
        
          <li class="file"><a href="../LATEST.html">LATEST</a></li>
        
          <li class="file"><a href="../LICENSE.html">LICENSE</a></li>
        
          <li class="file"><a href="../Links.html">Links</a></li>
        
          <li class="file"><a href="../NEWS.html">NEWS</a></li>
        
          <li class="file"><a href="../PHILOSOPHY.html">PHILOSOPHY</a></li>
        
          <li class="file"><a href="../README.html">README</a></li>
        
          <li class="file"><a href="../SIGNALS.html">SIGNALS</a></li>
        
          <li class="file"><a href="../Sandbox.html">Sandbox</a></li>
        
          <li class="file"><a href="../TODO.html">TODO</a></li>
        
          <li class="file"><a href="../TUNING.html">TUNING</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../Unicorn.html">Unicorn</a></li>
        
          <li><a href="../Unicorn/App.html">Unicorn::App</a></li>
        
          <li><a href="../Unicorn/App/OldRails.html">Unicorn::App::OldRails</a></li>
        
          <li><a href="../Unicorn/App/OldRails/Static.html">Unicorn::App::OldRails::Static</a></li>
        
          <li><a href="../Unicorn/CGIWrapper.html">Unicorn::CGIWrapper</a></li>
        
          <li><a href="../Unicorn/ClientShutdown.html">Unicorn::ClientShutdown</a></li>
        
          <li><a href="../Unicorn/Configurator.html">Unicorn::Configurator</a></li>
        
          <li><a href="../Unicorn/HttpParser.html">Unicorn::HttpParser</a></li>
        
          <li><a href="../Unicorn/HttpServer.html">Unicorn::HttpServer</a></li>
        
          <li><a href="../Unicorn/OobGC.html">Unicorn::OobGC</a></li>
        
          <li><a href="../Unicorn/PrereadInput.html">Unicorn::PrereadInput</a></li>
        
          <li><a href="../Unicorn/SSLClient.html">Unicorn::SSLClient</a></li>
        
          <li><a href="../Unicorn/SSLConfigurator.html">Unicorn::SSLConfigurator</a></li>
        
          <li><a href="../Unicorn/StreamInput.html">Unicorn::StreamInput</a></li>
        
          <li><a href="../Unicorn/TeeInput.html">Unicorn::TeeInput</a></li>
        
          <li><a href="../Unicorn/TmpIO.html">Unicorn::TmpIO</a></li>
        
          <li><a href="../Unicorn/Util.html">Unicorn::Util</a></li>
        
          <li><a href="../Unicorn/Worker.html">Unicorn::Worker</a></li>
        
          <li><a href="../ExecCgi/ExecCgi.html">ExecCgi::ExecCgi</a></li>
        
          <li><a href="../Inetd/Inetd.html">Inetd::Inetd</a></li>
        
          <li><a href="../Object.html">Object</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">Unicorn::TeeInput</h1>

    <div id="description" class="description">
      
<p>acts like tee(1) on an input input to provide a input-like stream while
providing rewindable semantics through a File/StringIO backing store.  On
the first pass, the input is only read on demand so your Rack application
can use input notification (upload progress and like).  This should fully
conform to the Rack::Lint::InputWrapper specification on the public API. 
This class is intended to be a strict interpretation of
Rack::Lint::InputWrapper functionality and will not support any deviations
from it.</p>

<p>When processing uploads, <a href="../Unicorn.html">Unicorn</a> exposes a <a
href="TeeInput.html">TeeInput</a> object under “rack.input” of the Rack
environment.</p>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="client_body_buffer_size-method" class="method-detail ">
          <a name="method-c-client_body_buffer_size"></a>

          
          <div class="method-heading">
            <span class="method-name">client_body_buffer_size</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>returns the maximum size of request bodies to buffer in memory, amounts
larger than this are buffered to the filesystem</p>
            

            
            <div class="method-source-code" id="client_body_buffer_size-source">
<pre>
<span class="ruby-comment"># File lib/unicorn/tee_input.rb, line 26</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_body_buffer_size</span>
  <span class="ruby-identifier">@@client_body_buffer_size</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- client_body_buffer_size-source -->
            
          </div>

          

          
        </div><!-- client_body_buffer_size-method -->

      
        <div id="client_body_buffer_size-3D-method" class="method-detail ">
          <a name="method-c-client_body_buffer_size-3D"></a>

          
          <div class="method-heading">
            <span class="method-name">client_body_buffer_size=</span><span
              class="method-args">(bytes)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>sets the maximum size of request bodies to buffer in memory, amounts larger
than this are buffered to the filesystem</p>
            

            
            <div class="method-source-code" id="client_body_buffer_size-3D-source">
<pre>
<span class="ruby-comment"># File lib/unicorn/tee_input.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">client_body_buffer_size=</span>(<span class="ruby-identifier">bytes</span>)
  <span class="ruby-identifier">@@client_body_buffer_size</span> = <span class="ruby-identifier">bytes</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- client_body_buffer_size-3D-source -->
            
          </div>

          

          
        </div><!-- client_body_buffer_size-3D-method -->

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(socket, request)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Initializes a new <a href="TeeInput.html">TeeInput</a> object.  You
normally do not have to call this unless you are writing an HTTP server.</p>
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File lib/unicorn/tee_input.rb, line 32</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">socket</span>, <span class="ruby-identifier">request</span>)
  <span class="ruby-ivar">@len</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">content_length</span>
  <span class="ruby-keyword">super</span>
  <span class="ruby-ivar">@tmp</span> = <span class="ruby-ivar">@len</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@len</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">@@client_body_buffer_size</span> <span class="ruby-operator">?</span>
         <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-constant">Unicorn</span><span class="ruby-operator">::</span><span class="ruby-constant">TmpIO</span>.<span class="ruby-identifier">new</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="gets-method" class="method-detail ">
          <a name="method-i-gets"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">gets   => string or nil</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          

          <div class="method-description">
            
            <p>Reads the next “line” from the I/O stream; lines are separated by the
global record separator ($/, typically “n”). A global record separator of
nil reads the entire unread contents of ios. Returns nil if called at the
end of file. This takes zero arguments for strict Rack::Lint compatibility,
unlike IO#gets.</p>
            

            
            <div class="method-source-code" id="gets-source">
<pre>
<span class="ruby-comment"># File lib/unicorn/tee_input.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gets</span>
  <span class="ruby-ivar">@socket</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">tee</span>(<span class="ruby-keyword">super</span>) <span class="ruby-operator">:</span> <span class="ruby-ivar">@tmp</span>.<span class="ruby-identifier">gets</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- gets-source -->
            
          </div>

          

          
        </div><!-- gets-method -->

      
        <div id="read-method" class="method-detail ">
          <a name="method-i-read"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">read([length [, buffer ]]) => string, buffer, or nil</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          

          <div class="method-description">
            
            <p>Reads at most length bytes from the I/O stream, or to the end of file if
length is omitted or is nil. length must be a non-negative integer or nil.
If the optional buffer argument is present, it must reference a String,
which will receive the data.</p>

<p>At end of file, it returns nil or “” depend on length. ios.read() and
ios.read(nil) returns “”. ios.read(length [, buffer]) returns nil.</p>

<p>If the Content-Length of the HTTP request is known (as is the common case
for POST requests), then ios.read(length [, buffer]) will block until the
specified length is read (or it is the last chunk). Otherwise, for uncommon
“Transfer-Encoding: chunked” requests, ios.read(length [, buffer]) will
return immediately if there is any data and only block when nothing is
available (providing IO#readpartial semantics).</p>
            

            
            <div class="method-source-code" id="read-source">
<pre>
<span class="ruby-comment"># File lib/unicorn/tee_input.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">read</span>(*<span class="ruby-identifier">args</span>)
  <span class="ruby-ivar">@socket</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">tee</span>(<span class="ruby-keyword">super</span>) <span class="ruby-operator">:</span> <span class="ruby-ivar">@tmp</span>.<span class="ruby-identifier">read</span>(*<span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- read-source -->
            
          </div>

          

          
        </div><!-- read-method -->

      
        <div id="rewind-method" class="method-detail ">
          <a name="method-i-rewind"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">rewind    => 0</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          

          <div class="method-description">
            
            <p>Positions the <b>ios</b> pointer to the beginning of input, returns the
offset (zero) of the <tt>ios</tt> pointer.  Subsequent reads will start
from the beginning of the previously-buffered input.</p>
            

            
            <div class="method-source-code" id="rewind-source">
<pre>
<span class="ruby-comment"># File lib/unicorn/tee_input.rb, line 105</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rewind</span>
  <span class="ruby-keyword">return</span> <span class="ruby-value">0</span> <span class="ruby-keyword">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@tmp</span>.<span class="ruby-identifier">size</span>
  <span class="ruby-identifier">consume!</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@socket</span>
  <span class="ruby-ivar">@tmp</span>.<span class="ruby-identifier">rewind</span> <span class="ruby-comment"># Rack does not specify what the return value is here</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- rewind-source -->
            
          </div>

          

          
        </div><!-- rewind-method -->

      
        <div id="size-method" class="method-detail ">
          <a name="method-i-size"></a>

          
          
          <div class="method-heading">
            <span class="method-callseq">size  => Integer</span>
            
            <span class="method-click-advice">click to toggle source</span>
            
          </div>
          
          

          <div class="method-description">
            
            <p>Returns the size of the input.  For requests with a Content-Length header
value, this will not read data off the socket and just return the value of
the Content-Length header as an Integer.</p>

<p>For Transfer-Encoding:chunked requests, this requires consuming all of the
input stream before returning since there’s no other way to determine the
size of the request body beforehand.</p>

<p>This method is no longer part of the Rack specification as of Rack 1.2, so
its use is not recommended.  This method only exists for compatibility with
Rack applications designed for Rack 1.1 and earlier.  Most applications
should only need to call <tt>read</tt> with a specified <tt>length</tt> in
a loop until it returns <tt>nil</tt>.</p>
            

            
            <div class="method-source-code" id="size-source">
<pre>
<span class="ruby-comment"># File lib/unicorn/tee_input.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">size</span>
  <span class="ruby-ivar">@len</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">return</span> <span class="ruby-ivar">@len</span>
  <span class="ruby-identifier">pos</span> = <span class="ruby-ivar">@tmp</span>.<span class="ruby-identifier">pos</span>
  <span class="ruby-identifier">consume!</span>
  <span class="ruby-ivar">@tmp</span>.<span class="ruby-identifier">pos</span> = <span class="ruby-identifier">pos</span>
  <span class="ruby-ivar">@len</span> = <span class="ruby-ivar">@tmp</span>.<span class="ruby-identifier">size</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- size-source -->
            
          </div>

          

          
        </div><!-- size-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

